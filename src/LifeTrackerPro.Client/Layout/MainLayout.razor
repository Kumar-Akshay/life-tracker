@inherits LayoutComponentBase
@inject AuthStateProvider AuthState
@inject NavigationManager Nav

@if (AuthState.IsAuthenticated)
{
    <div class="lt-app-shell">
        <!-- ── Sidebar ── -->
        <nav class="lt-sidebar">
            <!-- Brand -->
            <div class="lt-sidebar-brand">
                <div class="lt-sidebar-logo"><span>L</span></div>
                <div>
                    <div class="lt-sidebar-title">LifeTracker</div>
                    <div class="lt-sidebar-subtitle">PRO</div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="lt-nav">
                <NavLink class="lt-nav-item" href="dashboard" Match="NavLinkMatch.All" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.GridView" Size="Size.Small" />
                    <span>Dashboard</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="daily-log" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.EditCalendar" Size="Size.Small" />
                    <span>Daily Logger</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="spending" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.AttachMoney" Size="Size.Small" />
                    <span>Spending</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="goals" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.TrackChanges" Size="Size.Small" />
                    <span>Goals</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="life-pulse" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.MonitorHeart" Size="Size.Small" />
                    <span>Life Pulse</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="habits" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.CheckCircle" Size="Size.Small" />
                    <span>Habits</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="weekly-review" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.RateReview" Size="Size.Small" />
                    <span>Review</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="productivity" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.Bolt" Size="Size.Small" />
                    <span>Productivity</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="videos" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.PlayCircle" Size="Size.Small" />
                    <span>Videos</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="books" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.MenuBook" Size="Size.Small" />
                    <span>Books</span>
                </NavLink>
                <NavLink class="lt-nav-item" href="settings" Match="NavLinkMatch.Prefix" ActiveClass="active">
                    <MudIcon Icon="@Icons.Material.Outlined.Settings" Size="Size.Small" />
                    <span>Settings</span>
                </NavLink>
            </div>

            <!-- User Card -->
            <div class="lt-sidebar-user">
                <div class="lt-sidebar-user-inner">
                    <div class="lt-sidebar-avatar">@(_initials)</div>
                    <div>
                        <div class="lt-sidebar-user-name">@(AuthState.CurrentUser?.FullName ?? "User")</div>
                        <div class="lt-sidebar-user-streak">Tracking life 🔥</div>
                    </div>
                    <div style="margin-left:auto;">
                        <MudIconButton Icon="@Icons.Material.Outlined.Logout" Size="Size.Small"
                                       Style="color:var(--ink-faint);" OnClick="HandleLogout" />
                    </div>
                </div>
            </div>
        </nav>

        <!-- ── Main Content ── -->
        <main class="lt-main page-enter">
            @Body
        </main>
    </div>
}
else
{
    @Body
}

@code {
    private string _initials => AuthState.CurrentUser?.FullName?.Length > 0
        ? AuthState.CurrentUser.FullName[..1].ToUpper()
        : "U";

    private async Task HandleLogout()
    {
        AuthState.ClearToken();
        Nav.NavigateTo("/login");
        await Task.CompletedTask;
    }
}
