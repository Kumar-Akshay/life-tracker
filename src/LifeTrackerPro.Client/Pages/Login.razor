@page "/login"
@inject AuthService Auth
@inject NavigationManager Nav
@inject ISnackbar Snackbar

<PageTitle>Login â€” LifeTracker Pro</PageTitle>

<div style="display:flex; justify-content:center; align-items:center; min-height:90vh;">
    <MudCard Style="width:420px; background:#1a1830; border:1px solid #2d2a4a;">
        <MudCardContent>
            <MudText Typo="Typo.h4" Align="Align.Center" Style="font-weight:700; color:#6366F1;" Class="mb-4">
                LifeTracker Pro
            </MudText>
            <MudText Typo="Typo.body2" Align="Align.Center" Class="mb-6" Style="color:#94A3B8;">
                Sign in to your account
            </MudText>

            <MudTextField @bind-Value="_email" Label="Email" Variant="Variant.Outlined"
                          InputType="InputType.Email" Class="mb-3" FullWidth="true" />
            <MudTextField @bind-Value="_password" Label="Password" Variant="Variant.Outlined"
                          InputType="InputType.Password" Class="mb-4" FullWidth="true" />

            <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true"
                       OnClick="HandleLogin" Disabled="_loading" Class="mb-3">
                @if (_loading) { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" /> }
                Sign In
            </MudButton>

            <MudText Typo="Typo.body2" Align="Align.Center" Style="color:#94A3B8;">
                Don't have an account?
                <MudLink Href="/register" Underline="Underline.Always" Style="color:#6366F1;">Sign up</MudLink>
            </MudText>
        </MudCardContent>
    </MudCard>
</div>

@code {
    private string _email = string.Empty;
    private string _password = string.Empty;
    private bool _loading;

    private async Task HandleLogin()
    {
        _loading = true;
        try
        {
            var result = await Auth.LoginAsync(new LoginRequestDto
            {
                Email = _email,
                Password = _password
            });

            if (result?.Success == true)
            {
                Nav.NavigateTo("/dashboard");
            }
            else
            {
                Snackbar.Add(result?.Errors.FirstOrDefault() ?? "Login failed.", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _loading = false;
        }
    }
}
