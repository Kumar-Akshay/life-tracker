@page "/dashboard"
@inject DashboardService DashboardSvc

<PageTitle>Dashboard — LifeTracker Pro</PageTitle>

<div class="page-enter">
    <!-- Heading -->
    <h1 class="lt-page-heading">Your <span class="accent">Dashboard</span></h1>
    <p class="lt-page-subtitle">Analytics, trends, and life insights at a glance</p>

    <!-- KPI Row -->
    <div class="lt-kpi-grid">
        <div class="lt-card">
            <div class="lt-stat-label">Days Logged</div>
            <div class="lt-stat-value">28</div>
            <div class="lt-stat-delta">▲ 4 this week</div>
        </div>
        <div class="lt-card">
            <div class="lt-stat-label">Total Hours</div>
            <div class="lt-stat-value">664<span class="unit">h</span></div>
            <div class="lt-stat-delta">100% coverage</div>
        </div>
        <div class="lt-card">
            <div class="lt-stat-label">Avg Sleep</div>
            <div class="lt-stat-value">8.8<span class="unit">h</span></div>
            <div class="lt-stat-delta">▲ 0.3h</div>
        </div>
        <div class="lt-card">
            <div class="lt-stat-label">Spent</div>
            <div class="lt-stat-value">$373</div>
            <div class="lt-stat-delta">Under budget</div>
        </div>
    </div>

    <!-- Distribution & By Category -->
    <div class="lt-chart-grid-2">
        <div class="lt-card">
            <div class="lt-section-label"><span>Distribution</span></div>
            <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center; padding:16px 0;">
                @foreach (var (name, hours, color) in _distribution)
                {
                    <div style="text-align:center;">
                        <div style="width:60px; height:60px; border-radius:50%; background:@(color)18; border:3px solid @color; display:flex; align-items:center; justify-content:center; margin:0 auto 6px;">
                            <span style="font-family:var(--font-mono); font-size:12px; font-weight:800; color:@color;">@hours</span>
                        </div>
                        <span style="font-size:10px; color:var(--ink-muted); font-family:var(--font-mono);">@name</span>
                    </div>
                }
            </div>
        </div>
        <div class="lt-card">
            <div class="lt-section-label"><span>By Category</span></div>
            @foreach (var (name, hours, color) in _distribution)
            {
                <div style="margin-bottom:10px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                        <span style="font-size:12px; color:var(--ink-soft); font-family:var(--font-sans); font-weight:600;">@name</span>
                        <span style="font-size:12px; color:@color; font-family:var(--font-mono); font-weight:700;">@hours h</span>
                    </div>
                    <div class="lt-progress-track">
                        <div class="lt-progress-fill" style="width:@(Math.Min(hours * 100 / 200, 100))%; background:@color;"></div>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Weekly Trends -->
    <div class="lt-card" style="margin-bottom:22px;">
        <div class="lt-section-label"><span>Weekly Trends</span></div>
        <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:12px;">
            @foreach (var week in _weeklyTrends)
            {
                <div style="text-align:center; padding:14px; border-radius:12px; background:var(--pampas); border:1px solid var(--border);">
                    <div style="font-size:10px; color:var(--ink-muted); font-family:var(--font-mono); text-transform:uppercase; letter-spacing:0.1em; margin-bottom:8px;">@week.Label</div>
                    <div style="display:flex; flex-direction:column; gap:6px;">
                        <div>
                            <div style="font-size:9px; color:#6B8EC7; font-family:var(--font-mono); margin-bottom:2px;">Sleep</div>
                            <div class="lt-progress-track" style="height:5px;">
                                <div class="lt-progress-fill" style="width:@(week.Sleep * 100 / 70)%; background:#6B8EC7;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="font-size:9px; color:var(--crail); font-family:var(--font-mono); margin-bottom:2px;">Work</div>
                            <div class="lt-progress-track" style="height:5px;">
                                <div class="lt-progress-fill" style="width:@(week.Work * 100 / 70)%; background:var(--crail);"></div>
                            </div>
                        </div>
                        <div>
                            <div style="font-size:9px; color:#5B8C51; font-family:var(--font-mono); margin-bottom:2px;">Exercise</div>
                            <div class="lt-progress-track" style="height:5px;">
                                <div class="lt-progress-fill" style="width:@(week.Exercise * 100 / 70)%; background:#5B8C51;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private readonly List<(string Name, int Hours, string Color)> _distribution = new()
    {
        ("Sleep", 196, "#6B8EC7"),
        ("Work", 176, "#C15F3C"),
        ("Exercise", 84, "#5B8C51"),
        ("Hobbies", 60, "#C49A2D"),
        ("Social", 52, "#5CAFC7"),
        ("Friends", 40, "#4A7EC7"),
        ("Travel", 28, "#B1ADA1"),
        ("Other", 28, "#D4795A")
    };

    private readonly List<WeekData> _weeklyTrends = new()
    {
        new("W1", 52, 42, 8),
        new("W2", 55, 40, 12),
        new("W3", 48, 35, 10),
        new("W4", 58, 45, 14)
    };

    private record WeekData(string Label, int Sleep, int Work, int Exercise);
}
